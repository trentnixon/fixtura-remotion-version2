# WARP.md

This file provides guidance to WARP (warp.dev) when working with code in this repository.

Project: Fixtura Remotion V2 (React + TypeScript + Remotion 4 + Tailwind v4)

- Entry: src/index.ts (registers RemotionRoot)
- Dev root: src/DevelopmentRoot.tsx
- Prod root: src/ProductionRoot.tsx
- Templates registry: src/templates/registry.tsx
- Test datasets: testData/index.ts
- Remotion config: remotion.config.ts (Tailwind enabled, PNG frames, overwrite)

Commands

- Install dependencies
  ```pwsh path=null start=null
  npm ci
  ```

- Start Remotion Studio (development)
  ```pwsh path=null start=null
  npm run dev
  ```
  Notes: The Studio exposes a folder tree of Templates → Variants → Sport → Dataset, generated by DevelopmentRoot using templateRegistry and datasetsByCategory. Select any leaf to preview a composition with sample data.

- Build web bundle (for rendering or Lambda site)
  ```pwsh path=null start=null
  npm run build
  ```

- Type check / lint and format
  ```pwsh path=null start=null
  npm run lint        # TypeScript type check (tsc)
  npm run lint:fix    # ESLint fix (configured via @remotion/eslint-config-flat)
  npm run format      # Prettier write
  ```

- List available compositions from the entry file
  ```pwsh path=null start=null
  npx remotion compositions src/index.ts
  ```

- Render a single composition locally (CLI)
  ProductionRoot expects an input prop of shape { data: FixturaDataset }. The composition id is built as:
  <templateId>-<variant>-<compositionId>

  Minimal example (replace fields with real values from your data):
  ```pwsh path=null start=null
  npx remotion render src/index.ts Basic-Solid-Schedule out/video.mp4 --props '{
    "data": {
      "timings": {"FPS_INTRO": 30, "FPS_MAIN": 300, "FPS_OUTRO": 30},
      "videoMeta": {
        "video": {
          "appearance": {"template": "Basic"},
          "templateVariation": {"useBackground": "Solid"},
          "metadata": {"compositionId": "Schedule", "includeSponsors": false}
        }
      }
    }
  }'
  ```
  Tips:
  - Use the Studio to confirm templateId and variant combinations first.
  - durationInFrames is derived in ProductionRoot from data.timings and includeSponsors.

- Deploy Remotion site to AWS Lambda (site only)
  ```pwsh path=null start=null
  npm run deploy
  ```
  This runs: npx remotion lambda sites create src/index.ts --site-name=fixtura-remotion-v2 --region=ap-southeast-2
  Rendering via Lambda is supported by @remotion/lambda; use your standard Remotion Lambda flow after deploying the site.

Running a “single test”

This project does not include a unit test framework. Treat an isolated composition render as the equivalent of a “single test”. Use either:
- Studio: Navigate to a specific Template → Variant → Sport → Dataset and preview.
- CLI: Render one composition with a minimal FixturaDataset as shown above.

High-level architecture

- Runtime selection (src/Root.tsx)
  - RemotionRoot chooses between DevelopmentRoot and ProductionRoot based on the rendering environment (isRemotionRender()).

- DevelopmentRoot (src/DevelopmentRoot.tsx)
  - Builds a navigable tree of compositions using:
    - templateRegistry: maps TemplateId → component and variants.
    - datasetsByCategory: organizes sample datasets by sport and dataset id.
  - For each combination (Template × Variant × Sport × Dataset), renders a dev CompositionEntry to preview.

- ProductionRoot (src/ProductionRoot.tsx)
  - Expects an input prop { data: FixturaDataset } via Remotion getInputProps().
  - Validates required fields: templateId (appearance.template), variant (templateVariation.useBackground), compositionId (metadata.compositionId).
  - Computes composition id as `${templateId}-${useBackground}-${compositionId}`.
  - Calculates duration from data.timings and includeSponsors, renders at 1080×1350, 30 fps.

- Templates and variants (src/templates/registry.tsx)
  - Central registry binding template ids to React components.
  - Shared list of variants: ["Graphics", "Solid", "Image", "Gradient", "Video", "Particle", "Pattern", "Texture"].
  - Add new templates here to expose them across Dev and Prod flows.

- Components (overview)
  - Located under src/components with categories: backgrounds, layout, containers, typography, images, animations, ui, etc.
  - Backgrounds expose multiple visual strategies and are selected via the variant (e.g., Solid, Gradient, Image, Video).
  - Layout/containers compose typography and imagery into reusable scenes that templates orchestrate.

- Data and samples
  - testData/index.ts aggregates JSON samples by sport and exposes datasetsByCategory for Studio exploration.
  - In production renders, supply a complete FixturaDataset; DevelopmentRoot is for sample-driven browsing only.

- Configuration
  - remotion.config.ts enables Tailwind v4 via enableTailwind(), sets image format to PNG, and allows overwriting outputs.

Referenced rules and docs

- Cursor rules (memory-bank/.cursorrules)
  - Use npm run dev for Studio.
  - Maintain the Memory Bank docs as you evolve patterns and structure.

- README.md (root)
  - Minimal; refer to this WARP.md for commands and architecture until README is expanded.
